<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/index.css">
    <script src="/scripts/index.js" defer></script>
    <title>Chiikawa Post</title>
  </head>
  <body>
    <header>
      <img class="header-icon" src="/assets/postIcons/chiikawa-icon.png">
      <div>
        <h1>Chiikawa Post</h1>
        <nav>
          <% if (locals.currentUser) {%>
            <a href="/log-out"><button class="primary-button">LOG OUT</button></a>
            <% if (!locals.currentUser.is_member) { %>
              <a href="/member"><button class="primary-button">MEMBERSHIP</button></a>
            <% } else if (!locals.currentUser.is_admin) { %>
              <a href="/admin"><button class="primary-button">Admin</button></a>
            <% } %>
          <% } else { %>
            <a href="/sign-up"><button class="primary-button">Sign Up</button></a>
            <a href="/log-in"><button class="primary-button">Log In</button></a>
          <% } %>
        </nav>
      </div>
      <img class="header-icon" src="/assets/postIcons/hachiware-icon.png">
    </header>
    <main>
      <% if (locals.currentUser) {%>
        <h2>Welcome <%= currentUser.is_admin ? 'admin' : currentUser.is_member ? 'member' : '' %>  <%= currentUser.firstname %>!</h2>
        <a href="/post"><button class="primary-button new-post-button">Make a new post!</button></a>
      <% } else { %>
        <h2>Log in to make a post!</h2>
      <% } %>
      <ul class="post-holder">
        <% if (locals.posts) { %>
          <% posts.forEach((post) => { %>
            <li class="card">
              <div class="card-header">
                <img class="card-icon icon-left" src="">
                <img class="card-main-icon" src='/assets/postImages/<%= post.image_src %>'>
                <img class="card-icon icon-right" src="">
              </div>
              <div class="card-content">
                <h3 class="card-title"><%= post.title %></h3>
                <p><%= post.message %></p>
                  <h4>From: <%= post.firstname ? post.firstname : 'Anonymous mob creature'%> <%= post.lastname %></h4>
                  <h5>Time: <%= post.send_time ? post.send_time : 'ウーラヤハヤハウーラ' %></h5>
                <% if (locals.currentUser && locals.currentUser.is_admin) { %>
                  <form action="/post/delete/<%= post.id %>" method="POST">
                    <button class="delete-btn secondary-button">Delete</button>
                  </form>
                <% } %>
              </div>
            </li>
          <% }) %>
        <% } %>
      </ul>
    </main>
  </body>
</html>
